data_source: fauna

segments:
  h3n2:
    - ha
    - na
  h1n1pdm:
    - ha
    - na


array-builds:
  nextstrain:
    patterns:
      lineage:
        - h3n2
        - h1n1pdm
      center:
        - who
        - cdc
      assay:
        - hi
        - fra
      resolution:
        - 0.5
        - 2
        - 3
    build_name: "{lineage}_{center}_{assay}_{resolution}y"
    reference: "config/{lineage}/{{segment}}/reference.fasta"
    annotation: "config/{lineage}/{{segment}}/genemap.gff"
    tree_exclude_sites: "config/{lineage}/{{segment}}/exclude-sites.txt"
    subsampling_parameters:
      size: "4000"
      min-date: '(datetime.datetime.today() - datetime.timedelta(days={resolution}*365)).strftime("%Y-%m-%d")'
      include: "'config/{lineage}/reference_strains.txt'"
      exclude: "'config/{lineage}/outliers.txt'"
    subsamples:
      global:
          filters: "--group-by region year month --subsample-max-sequences {size} --min-date {min-date} --include {include} --exclude {exclude}"
          priorities: titers
